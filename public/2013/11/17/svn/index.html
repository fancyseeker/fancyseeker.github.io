
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>CentOS/Fedora下SVN+Apache服务器配置 | FancySeeker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="SVN简介
SVN是一个优秀的版本管理工具，并且适用于小型的团队开发。SVN可以独立服务器运行或者借助Apache运行，所谓独立运行是指在服务器上配置好SVN服务器后，网内的计算机可以利用诸如TortoiseSVN这样的SVN客户端软件通过SVN协议(svn://...)对服务器进行签出(checkout)提交(commit)等操作。若SVN借助Apache运行，则可通过浏览器的http协议直接访">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS/Fedora下SVN+Apache服务器配置">
<meta property="og:url" content="http://fancyseeker.github.io/2013/11/17/svn/index.html">
<meta property="og:site_name" content="FancySeeker">
<meta property="og:description" content="SVN简介
SVN是一个优秀的版本管理工具，并且适用于小型的团队开发。SVN可以独立服务器运行或者借助Apache运行，所谓独立运行是指在服务器上配置好SVN服务器后，网内的计算机可以利用诸如TortoiseSVN这样的SVN客户端软件通过SVN协议(svn://...)对服务器进行签出(checkout)提交(commit)等操作。若SVN借助Apache运行，则可通过浏览器的http协议直接访">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CentOS/Fedora下SVN+Apache服务器配置">
<meta name="twitter:description" content="SVN简介
SVN是一个优秀的版本管理工具，并且适用于小型的团队开发。SVN可以独立服务器运行或者借助Apache运行，所谓独立运行是指在服务器上配置好SVN服务器后，网内的计算机可以利用诸如TortoiseSVN这样的SVN客户端软件通过SVN协议(svn://...)对服务器进行签出(checkout)提交(commit)等操作。若SVN借助Apache运行，则可通过浏览器的http协议直接访">
  
    <link rel="alternative" href="/atom.xml" title="FancySeeker" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-img"></div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">FancySeeker</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Welcome, my friends.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <!-- <a id="main-nav-toggle" class="nav-icon"></a> -->
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="fancyseeker.github.io">
        </form>
      </div>
    </div>
	
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-svn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
          <div class="article-meta">
            
            <a href="/2013/11/17/svn/" class="article-date">
  <time datetime="2013-11-17T06:03:34.000Z" itemprop="datePublished">2013-11-17</time>
</a>
            <p class="article-author">fancyseeker</p>
          </div>
        
        
  
    <h1 class="article-title" itemprop="name">
      CentOS/Fedora下SVN+Apache服务器配置
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
       <!--<h1>SVN简介</h1>
<p>SVN是一个优秀的版本管理工具，并且适用于小型的团队开发。SVN可以独立服务器运行或者借助Apache运行，所谓独立运行是指在服务器上配置好SVN服务器后，网内的计算机可以利用诸如TortoiseSVN这样的SVN客户端软件通过SVN协议(svn://<strong><em>.</em></strong>.<strong><em>.</em></strong>)对服务器进行签出(checkout)提交(commit)等操作。若SVN借助Apache运行，则可通过浏览器的http协议直接访问服务器对应地址下的代码。</p>
<p>本文先讲述如何单独配置SVN服务器，之后再讲述如何添加Apache的http访问支持。</p>
<hr>
<h1>安装环境</h1>
<p>Fedora 19 / CentOS 6.4<br>
(Windows也可当作SVN服务器，貌似配置过程很简单，不过从稳定性上考虑，还是选用CentOS作为服务器更为理想)</p>
<hr>
<h1>SVN服务器配置</h1>
<h2>安装subversion包</h2>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># yum install subversion</span></span><br></pre></td></tr></table></figure>
<h2>初始化版本仓库(Repositories)</h2>
<p>安装完subversion后，需要初始化一个版本仓库，用于管理代码。 新建目录</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># mkdir -p /home/svn/project</span></span><br></pre></td></tr></table></figure>
<p>在新建的目录上创建仓库</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># svnadmin create /home/svn/project</span></span><br></pre></td></tr></table></figure>
<p>这里，<code>svnadmin create</code>之后跟的为版本仓库存放代码的目录地址，在本文中为 <code>/home/svn/project</code>，当然，可以根据需求改成其它目录，但请在以下的操作中根据具体目录进行对应的修改。 在执行完<code>svnadmin create</code>操作后，在创建的仓库下，会自动生成几个目录</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> /home/svn/project/</span><br><span class="line"><span class="keyword">conf</span>  <span class="keyword">db</span>  <span class="keyword">format</span>  hooks  locks  README.txt</span><br></pre></td></tr></table></figure>
<p>此时，如果你的电脑上有待进行管理的代码目录，可以将其导入(import)到SVN的仓库中。作为示例，这里要导入的代码目录为</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># svn <span class="keyword">import</span> <span class="regexp">/home/</span>chen<span class="regexp">/Lab file:/</span><span class="comment">//home/svn/project -m "初始化导入代码目录"</span></span><br></pre></td></tr></table></figure>
<p>在<code>svn import</code>命令中，末尾的<code>-m(--message)</code>选项表示为执行操作的日志消息，如果不加<code>-m</code> “消息内容”的话，此操作将会报错<code>svn: E205007</code>。<br>
如果导入成功，你将会看到诸如如下过程(此处截取了导入过程中的末尾部分)</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Adding  (bin)  <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span><span class="regexp">/PCM-Memory_Win/</span>pcm-memory-win.vcproj</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCoun(((ujterMonitorV2<span class="number">.4</span><span class="regexp">/freegetopt/</span>README</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span><span class="regexp">/freegetopt/</span>getopt.c</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span><span class="regexp">/freegetopt/</span>ChangeLog</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span>/.gitignore</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span>/FREEBSD_HOWTO.txt</span><br><span class="line"></span><br><span class="line">Committed revision <span class="number">1.</span></span><br></pre></td></tr></table></figure>
<h2>用户管理及权限设置</h2>
<p>SVN服务器的配置文件主要有3个，分别为</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/your_svn_repos/<span class="keyword">conf</span>/passwd --用户名及密码管理</span><br><span class="line">/your_svn_repos/<span class="keyword">conf</span>/authz  --权限配置</span><br><span class="line">/your_svn_repos/<span class="keyword">conf</span>/svnserve.<span class="keyword">conf</span>  --SVN全局配置文件</span><br></pre></td></tr></table></figure>
<h3>添加用户</h3>
<p>添加用户只需要打开<code>/home/svn/project/conf/passwd</code>文件，添加一行形如 <code>user = password</code> 条目即可。这里，作为示例，添加一个admin账户，密码为123456，以及其它2个账户则<code>passwd</code>文件如下</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### This file is an example password file for svnserve.</span></span><br><span class="line"><span class="comment">### Its format is similar to that of svnserve.conf. As shown in the</span></span><br><span class="line"><span class="comment">### example below it contains one section labelled [users].</span></span><br><span class="line"><span class="comment">### The name and password for each user follow, one account per line.</span></span><br><span class="line"></span><br><span class="line">[users]</span><br><span class="line"><span class="comment"># harry = harryssecret</span></span><br><span class="line"><span class="comment"># sally = sallyssecret</span></span><br><span class="line"><span class="constant">admin</span> = 123456</span><br><span class="line"><span class="constant">role_a</span> = 123456</span><br><span class="line"><span class="constant">role_b</span> = 123456</span><br></pre></td></tr></table></figure>
<h3>用户访问策略配置</h3>
<p><code>/home/svn/project/conf/authz</code>文件用于管理用户以及用户组的访问策略。authz文件中包含若干个节，包括<code>[groups]</code>以及类似<code>[repository:/baz/fuz]</code>这样的节，注意<code>[groups]</code>节，这里用于定义用户组，在<code>[groups]</code>节中定义完不同组的用户后可以很方便的利用组进行权限管理。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[groups]</span><br><span class="line"><span class="comment"># harry_and_sally = harry,sally</span></span><br><span class="line"><span class="comment"># harry_sally_and_joe = harry,sally,&amp;joe</span></span><br><span class="line">g_admin = admin</span><br><span class="line">g_common = role_a,role_b</span><br><span class="line"></span><br><span class="line">[/]</span><br><span class="line"><span class="comment">@g_admin = rw</span></span><br><span class="line"><span class="keyword">*</span> = </span><br><span class="line"></span><br><span class="line">[project:/]</span><br><span class="line"><span class="comment">@g_admin = rw</span></span><br><span class="line"><span class="comment">@g_common = rw</span></span><br><span class="line"><span class="keyword">*</span> =</span><br></pre></td></tr></table></figure>
<p>在以上的authz文件中，定义了组<code>g_admin</code>和<code>g_common</code>，<code>g_admin</code>组中包含有admin用户，<code>g_common</code>组中包含了用户role_a和role_b。<br>
接下来进行具体目录的权限控制，可用类似 <code>user = rw</code> 类似的方式为用户分配该目录的对应权限，也可用 <code>@groupname = rw</code> 类似的方式为用户组分配该目录的对应权限，r代表可读，w代表可写，rw代表可读可写。同时，一定要注意在末尾添加其他人的权限设置，利用 <code>*</code> 通配符代表除了之前提到的其他人。<code>* =</code> 表示其他人不具有任何权限。<br>
注意到文件中的两个节<code>[/]</code>和<code>[project:/]</code>，<code>[/]</code>表示SVN根目录的权限配置，而<code>[project:/]</code>表示库project的根目录权限配置，二者存在细微的差别，但是若没搞清楚，则会导致访问时验证失败或连接失败等问题。</p>
<h3>SVN全局配置文件</h3>
<p><code>/home/svn/project/conf/subserve.conf</code>为SVN的全局配置文件，这里取消对应行的注释并指定适当的值，注意不要行前不要留空格，具体如下:</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[general]</span><br><span class="line">anon-<span class="keyword">access</span> = none   <span class="comment">--匿名用户默认情况下不具有任何权限</span></span><br><span class="line">auth-<span class="keyword">access</span> = write  <span class="comment">--授权用户具默认情况下有写权限</span></span><br><span class="line">password-db = /home/svn/project/conf/passwd  <span class="comment">--指定passwd文件所在位置</span></span><br><span class="line">authz-db = /home/svn/project/conf/authz      <span class="comment">--指定authz文件所在位置</span></span><br></pre></td></tr></table></figure>
<h2>启动SVN服务器</h2>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># svnserve -d -r /home/svn</span></span><br></pre></td></tr></table></figure>
<p><code>-d</code> 表示以deamon方式运行，即后台运行。 <code>-r</code>用于指定SVN服务根目录，这里我们指定的根目录为 <code>/home/svn</code>。<br>
联系到authz文件中，<code>[/]</code>节中的权限则对应 <code>/home/svn</code> 下权限，<code>[project:/]</code>节中的权限即对应 <code>/home/svn/project</code> 下的权限。但是如果指定SVN服务根目录为 <code>/home/svn/project</code>，那么authz文件中<code>[/]</code>代表目录 <code>/home/svn/project</code>，而此时<code>[project:/]</code>则没有对应目录，因为<code>/home/svn/project</code>下并没有名为project的仓库，所以就会出错。<br>
如果修改了SVN的配置文件，那么需要重启SVN服务器才能使修改生效。</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># ps -aux|grep svnserve</span></span><br><span class="line"><span class="preprocessor"># kill -9 pid_of_svnserve</span></span><br><span class="line"><span class="preprocessor"># svnserve -d -r /home/svn</span></span><br></pre></td></tr></table></figure>
<h2>在防火墙中开放SVN端口</h2>
<p>如果不在防火墙中开放SVN默认端口3690，则会出现，服务器本机可以访问SVN服务，而其它网内机器无法连接SVN服务器的错误。<br>
首先关闭selinux，修改 <code>/etc/selinux/config</code> 文件</p>
<figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SELINUX</span>=<span class="string">disabled</span></span><br></pre></td></tr></table></figure>
<p>SVN服务的默认端口为3690，设置防火墙开放3690端口</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># iptables -I INPUT -p tcp --dport 3690 -j ACCEPT</span></span><br><span class="line"><span class="preprocessor"># iptables -I OUTPUT -p tcp --sport 3690 -j ACCEPT</span></span><br><span class="line"><span class="preprocessor"># service iptables save</span></span><br><span class="line"><span class="preprocessor"># service iptables restart</span></span><br></pre></td></tr></table></figure>
<h2>测试SVN服务器</h2>
<p>随意找一个目录，尝试从SVN服务器签出(check out)仓库</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># svn co svn://58.154.190.***/project</span></span><br><span class="line">Authentication realm: &lt;svn://<span class="number">58.154</span><span class="number">.190</span>.***:<span class="number">3690</span>&gt; ecf95e5d-5de1-44de-91b3-f44b1bd795d1</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'root'</span>: </span><br><span class="line">Authentication realm: &lt;svn://<span class="number">58.154</span><span class="number">.190</span>.***:<span class="number">3690</span>&gt; ecf95e5d-5de1-44de-91b3-f44b1bd795d1</span><br><span class="line">Username: admin</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'admin'</span>: </span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">ATTENTION!  Your password <span class="keyword">for</span> authentication realm:</span><br><span class="line"></span><br><span class="line">   &lt;svn://<span class="number">58.154</span><span class="number">.190</span>.***:<span class="number">3690</span>&gt; ecf95e5d-5de1-44de-91b3-f44b1bd795d1</span><br><span class="line"></span><br><span class="line">can only be stored to disk unencrypted!  You are advised to configure</span><br><span class="line">your system so that Subversion can store passwords encrypted, <span class="keyword">if</span></span><br><span class="line">possible.  See the documentation <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">You can avoid future appearances of this <span class="keyword">warning</span> by setting the value</span><br><span class="line">of the <span class="string">'store-plaintext-passwords'</span> option to either <span class="string">'yes'</span> or <span class="string">'no'</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">'/root/.subversion/servers'</span>.</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">Store password unencrypted (yes/no)?yes </span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line">A    project/IntelPerformanceCounterMonitorV2.4/pcm3d/widget.h</span><br><span class="line">A    project/IntelPerformanceCounterMonitorV2.4/pcm-memory.cpp</span><br><span class="line">A    project/IntelPerformanceCounterMonitorV2.4/pcm-sensor.cpp</span><br><span class="line">A    project/IntelPerformanceCounterMonitorV2.4/.gitattributes</span><br><span class="line">Checked out revision <span class="number">1.</span></span><br></pre></td></tr></table></figure>
<p>在第一次签出的时候会提示是否保存明文密码(因为SVN的密码是明文保存的，所以SVN的账户安全依赖与Linux系统账户的安全)选择&quot;yes&quot;的话下次就不需要在输入密码了，反之，选择&quot;no&quot;的话下次操作还需进行身份验证。如果想换个身份操作SVN或者密码输错太多被拒绝，可以删除用户目录下的 <code>～/.subversion</code> 文件夹以清空身份信息。<br>
如果能顺利 check out revision 则表明独立SVN服务器配置已成功。<br>
这时不论是在服务器本机上还是其它客户端机器，均能使用SVN服务。对于客户端操作系统为Windows的计算机，可以安装TortoiseSVN进行相应的客户端操作。</p>
<hr>
<h1>为SVN服务器添加HTTP支持</h1>
<p>经过上面的配置过程后，SVN服务器已经可以正常使用，但是，只能通过SVN协议，无法通过http协议访问。为SVN服务器添加HTTP支持可以使得用户能用浏览器通过HTTP协议直接查看仓库内容，同时也可以在代码签出提交时使用HTTP协议。</p>
<h2>安装必要包</h2>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd mod_dav_svn mod_perl  <span class="keyword">perl</span>* ntsysv <span class="keyword">vim</span>-enhanced</span><br></pre></td></tr></table></figure>
<h2>转换SVN明文密码为HTTP要求的加密格式</h2>
<p>SVN的密码是明文保存的，而http服务器不支持明文密码，所以需要将SVN服务的明文密码转换为http要求的加密格式，可以通过以下的perl脚本完成：<br>
移动到 <code>/home/svn/project/conf</code> 目录下，新建并编辑perl脚本 <code>PtoWP.pl</code>  (此脚本的作者为ha97)</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/svn/project/<span class="keyword">conf</span>/</span><br><span class="line">vim PtoWP.<span class="keyword">pl</span></span><br></pre></td></tr></table></figure>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"><span class="keyword">use</span> warnings;</span><br><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"></span><br><span class="line"><span class="comment">#open the svn passwd file</span></span><br><span class="line"><span class="keyword">open</span> (FILE, <span class="string">"passwd"</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Cannot open the passwd file!!!n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#clear the apache passwd file</span></span><br><span class="line"><span class="keyword">open</span> (OUT_FILE, <span class="string">"&gt;webpasswd"</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Cannot open the webpasswd file!!!n"</span>);</span><br><span class="line"><span class="keyword">close</span> (OUT_FILE);</span><br><span class="line"></span><br><span class="line"><span class="comment">#begin</span></span><br><span class="line"><span class="keyword">foreach</span> () &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_</span> =~ <span class="regexp">m/^[^#].*=/</span>) &#123;</span><br><span class="line"><span class="variable">$_</span> =~ <span class="regexp">s/=//</span>;</span><br><span class="line"><span class="string">`htpasswd -b webpasswd $_`</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为脚本添加可执行属性</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># chmod +x PtoWP.pl</span></span><br></pre></td></tr></table></figure>
<p>在目录 <code>/home/svn/project/conf/passwd</code> 所在目录中运行<code>PtoWP.pl</code>脚本，对passwd文件进行转换</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># ./PtoWP.pl</span></span><br></pre></td></tr></table></figure>
<p>转换过程如下</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Adding</span> <span class="literal">password</span> for <span class="keyword">user</span> admin</span><br><span class="line"><span class="constant">Adding</span> <span class="literal">password</span> for <span class="keyword">user</span> role_a</span><br><span class="line"><span class="constant">Adding</span> <span class="literal">password</span> for <span class="keyword">user</span> role_b</span><br></pre></td></tr></table></figure>
<p>转换完成后目录下会出现一个 <code>webpasswd</code> 文件，即为http支持的密码文件。</p>
<h2>修改http.conf，使得http支持SVN</h2>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span> /etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
<p>在<code>httpd.conf</code>文件的最后添加如下信息</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务模块</span></span><br><span class="line"><span class="constant">D</span>AV svn</span><br><span class="line"><span class="comment"># SVN仓库根目录</span></span><br><span class="line"><span class="constant">S</span>VNPath /<span class="literal">home</span>/svn/<span class="literal">project</span>/</span><br><span class="line"><span class="comment"># 授权方式,这里配置为基本授权方式</span></span><br><span class="line"><span class="constant">Auth</span>Type <span class="constant">Basic</span></span><br><span class="line"><span class="comment"># 授权名</span></span><br><span class="line"><span class="constant">Auth</span>Name <span class="string">"svn for project"</span></span><br><span class="line"><span class="comment"># 用户名及用户密码文件</span></span><br><span class="line"><span class="constant">Auth</span>UserFile /<span class="literal">home</span>/svn/<span class="literal">project</span>/conf/webpasswd</span><br><span class="line"><span class="comment"># 访问权限配置文件</span></span><br><span class="line"><span class="constant">Authz</span>SVNAccessFile /<span class="literal">home</span>/svn/<span class="literal">project</span>/conf/authz</span><br><span class="line"><span class="constant">Satisfy</span> all</span><br><span class="line"><span class="comment"># 访问方式，这里配置为必须输入账户密码</span></span><br><span class="line"><span class="constant">Require</span> valid-<span class="keyword">user</span></span><br></pre></td></tr></table></figure>
<p>看了不少文章，有部分文章说在这里还需添加两个模块的语句，另外还需要 <code>yum install subversion-deps-*</code> 包来使得svn得到http的支持。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword"><span class="common">LoadModule</span></span> dav_svn_module modules/mod_dav_svn.so</span><br><span class="line"><span class="keyword"><span class="common">LoadModule</span></span> authz_svn_module modules/mod_authz_svn.so</span><br></pre></td></tr></table></figure>
<p>但是，根据官方的说明(Please note that the dependencies distribution subversion-deps-* is no longer available in 1.7 and later.)也就是说在1.7以及1.7之后的版本中不需要安装依赖的<code>subversion-deps-*</code>包，而本人实验证明，也不需要在<code>httpd.conf</code>文件中添加上述两行加载模块的语句。</p>
<p>修改SVN主目录的所有者和所属组为Apache</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chown -R apache.apache <span class="regexp">/home/</span>svn<span class="regexp">/project/</span></span><br></pre></td></tr></table></figure>
<h2>在防火墙中开放httpd服务的80端口</h2>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span></span><br><span class="line"><span class="preprocessor"># iptables -I OUTPUT -p tcp --sport 80 -j ACCEPT</span></span><br><span class="line"><span class="preprocessor"># service iptables save</span></span><br><span class="line"><span class="preprocessor"># service iptables restart</span></span><br></pre></td></tr></table></figure>
<p>如果不在防火墙中开放80端口，则会出前客户机无法通过http协议连接SVN服务器的情况。<br>
<strong>注:</strong> 关于服务重启命令，在fedora 19中采用的是systemctl restart service_name.service形式。</p>
<h2>重启httpd服务</h2>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># service httpd restart</span></span><br></pre></td></tr></table></figure>
<h2>通过浏览器测试</h2>
<p>在浏览器地址栏输入 <code>http://your_svn_server_ip/project</code>，在弹出的身份确认框中输入用户名密码，能通过浏览器查看SVN仓库。<br>
同时可以通过http协议执行svn操作</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ svn co <span class="string">http:</span><span class="comment">//your_svn_server_ip/project</span></span><br><span class="line">Authentication <span class="string">realm:</span> &lt;<span class="string">http:</span><span class="comment">//58.154.190.***:80&gt; svn for project</span></span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'chen'</span>: </span><br><span class="line">Authentication <span class="string">realm:</span> &lt;<span class="string">http:</span><span class="comment">//58.154.190.***:80&gt; svn for project</span></span><br><span class="line"><span class="string">Username:</span> admin</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'admin'</span>:</span><br></pre></td></tr></table></figure>
<h1>参考资料</h1>
<p><a href="http://www.ha97.com/4467.html" target="_blank" rel="external">（总结）CentOS Linux搭建SVN Server配置详解</a></p>
-->
            
            
                <h1>SVN简介</h1>
<p>SVN是一个优秀的版本管理工具，并且适用于小型的团队开发。SVN可以独立服务器运行或者借助Apache运行，所谓独立运行是指在服务器上配置好SVN服务器后，网内的计算机可以利用诸如TortoiseSVN这样的SVN客户端软件通过SVN协议(svn://<strong><em>.</em></strong>.<strong><em>.</em></strong>)对服务器进行签出(checkout)提交(commit)等操作。若SVN借助Apache运行，则可通过浏览器的http协议直接访问服务器对应地址下的代码。</p>
<p>本文先讲述如何单独配置SVN服务器，之后再讲述如何添加Apache的http访问支持。</p>
<hr>
<h1>安装环境</h1>
<p>Fedora 19 / CentOS 6.4<br>
(Windows也可当作SVN服务器，貌似配置过程很简单，不过从稳定性上考虑，还是选用CentOS作为服务器更为理想)</p>
<hr>
<h1>SVN服务器配置</h1>
<h2>安装subversion包</h2>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># yum install subversion</span></span><br></pre></td></tr></table></figure>
<h2>初始化版本仓库(Repositories)</h2>
<p>安装完subversion后，需要初始化一个版本仓库，用于管理代码。 新建目录</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># mkdir -p /home/svn/project</span></span><br></pre></td></tr></table></figure>
<p>在新建的目录上创建仓库</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># svnadmin create /home/svn/project</span></span><br></pre></td></tr></table></figure>
<p>这里，<code>svnadmin create</code>之后跟的为版本仓库存放代码的目录地址，在本文中为 <code>/home/svn/project</code>，当然，可以根据需求改成其它目录，但请在以下的操作中根据具体目录进行对应的修改。 在执行完<code>svnadmin create</code>操作后，在创建的仓库下，会自动生成几个目录</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> /home/svn/project/</span><br><span class="line"><span class="keyword">conf</span>  <span class="keyword">db</span>  <span class="keyword">format</span>  hooks  locks  README.txt</span><br></pre></td></tr></table></figure>
<p>此时，如果你的电脑上有待进行管理的代码目录，可以将其导入(import)到SVN的仓库中。作为示例，这里要导入的代码目录为</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># svn <span class="keyword">import</span> <span class="regexp">/home/</span>chen<span class="regexp">/Lab file:/</span><span class="comment">//home/svn/project -m "初始化导入代码目录"</span></span><br></pre></td></tr></table></figure>
<p>在<code>svn import</code>命令中，末尾的<code>-m(--message)</code>选项表示为执行操作的日志消息，如果不加<code>-m</code> “消息内容”的话，此操作将会报错<code>svn: E205007</code>。<br>
如果导入成功，你将会看到诸如如下过程(此处截取了导入过程中的末尾部分)</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Adding  (bin)  <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span><span class="regexp">/PCM-Memory_Win/</span>pcm-memory-win.vcproj</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCoun(((ujterMonitorV2<span class="number">.4</span><span class="regexp">/freegetopt/</span>README</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span><span class="regexp">/freegetopt/</span>getopt.c</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span><span class="regexp">/freegetopt/</span>ChangeLog</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span>/.gitignore</span><br><span class="line">Adding         <span class="regexp">/home/</span>chen<span class="regexp">/Lab/</span>IntelPerformanceCounterMonitorV2<span class="number">.4</span>/FREEBSD_HOWTO.txt</span><br><span class="line"></span><br><span class="line">Committed revision <span class="number">1.</span></span><br></pre></td></tr></table></figure>
<h2>用户管理及权限设置</h2>
<p>SVN服务器的配置文件主要有3个，分别为</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/your_svn_repos/<span class="keyword">conf</span>/passwd --用户名及密码管理</span><br><span class="line">/your_svn_repos/<span class="keyword">conf</span>/authz  --权限配置</span><br><span class="line">/your_svn_repos/<span class="keyword">conf</span>/svnserve.<span class="keyword">conf</span>  --SVN全局配置文件</span><br></pre></td></tr></table></figure>
<h3>添加用户</h3>
<p>添加用户只需要打开<code>/home/svn/project/conf/passwd</code>文件，添加一行形如 <code>user = password</code> 条目即可。这里，作为示例，添加一个admin账户，密码为123456，以及其它2个账户则<code>passwd</code>文件如下</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### This file is an example password file for svnserve.</span></span><br><span class="line"><span class="comment">### Its format is similar to that of svnserve.conf. As shown in the</span></span><br><span class="line"><span class="comment">### example below it contains one section labelled [users].</span></span><br><span class="line"><span class="comment">### The name and password for each user follow, one account per line.</span></span><br><span class="line"></span><br><span class="line">[users]</span><br><span class="line"><span class="comment"># harry = harryssecret</span></span><br><span class="line"><span class="comment"># sally = sallyssecret</span></span><br><span class="line"><span class="constant">admin</span> = 123456</span><br><span class="line"><span class="constant">role_a</span> = 123456</span><br><span class="line"><span class="constant">role_b</span> = 123456</span><br></pre></td></tr></table></figure>
<h3>用户访问策略配置</h3>
<p><code>/home/svn/project/conf/authz</code>文件用于管理用户以及用户组的访问策略。authz文件中包含若干个节，包括<code>[groups]</code>以及类似<code>[repository:/baz/fuz]</code>这样的节，注意<code>[groups]</code>节，这里用于定义用户组，在<code>[groups]</code>节中定义完不同组的用户后可以很方便的利用组进行权限管理。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[groups]</span><br><span class="line"><span class="comment"># harry_and_sally = harry,sally</span></span><br><span class="line"><span class="comment"># harry_sally_and_joe = harry,sally,&amp;joe</span></span><br><span class="line">g_admin = admin</span><br><span class="line">g_common = role_a,role_b</span><br><span class="line"></span><br><span class="line">[/]</span><br><span class="line"><span class="comment">@g_admin = rw</span></span><br><span class="line"><span class="keyword">*</span> = </span><br><span class="line"></span><br><span class="line">[project:/]</span><br><span class="line"><span class="comment">@g_admin = rw</span></span><br><span class="line"><span class="comment">@g_common = rw</span></span><br><span class="line"><span class="keyword">*</span> =</span><br></pre></td></tr></table></figure>
<p>在以上的authz文件中，定义了组<code>g_admin</code>和<code>g_common</code>，<code>g_admin</code>组中包含有admin用户，<code>g_common</code>组中包含了用户role_a和role_b。<br>
接下来进行具体目录的权限控制，可用类似 <code>user = rw</code> 类似的方式为用户分配该目录的对应权限，也可用 <code>@groupname = rw</code> 类似的方式为用户组分配该目录的对应权限，r代表可读，w代表可写，rw代表可读可写。同时，一定要注意在末尾添加其他人的权限设置，利用 <code>*</code> 通配符代表除了之前提到的其他人。<code>* =</code> 表示其他人不具有任何权限。<br>
注意到文件中的两个节<code>[/]</code>和<code>[project:/]</code>，<code>[/]</code>表示SVN根目录的权限配置，而<code>[project:/]</code>表示库project的根目录权限配置，二者存在细微的差别，但是若没搞清楚，则会导致访问时验证失败或连接失败等问题。</p>
<h3>SVN全局配置文件</h3>
<p><code>/home/svn/project/conf/subserve.conf</code>为SVN的全局配置文件，这里取消对应行的注释并指定适当的值，注意不要行前不要留空格，具体如下:</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[general]</span><br><span class="line">anon-<span class="keyword">access</span> = none   <span class="comment">--匿名用户默认情况下不具有任何权限</span></span><br><span class="line">auth-<span class="keyword">access</span> = write  <span class="comment">--授权用户具默认情况下有写权限</span></span><br><span class="line">password-db = /home/svn/project/conf/passwd  <span class="comment">--指定passwd文件所在位置</span></span><br><span class="line">authz-db = /home/svn/project/conf/authz      <span class="comment">--指定authz文件所在位置</span></span><br></pre></td></tr></table></figure>
<h2>启动SVN服务器</h2>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># svnserve -d -r /home/svn</span></span><br></pre></td></tr></table></figure>
<p><code>-d</code> 表示以deamon方式运行，即后台运行。 <code>-r</code>用于指定SVN服务根目录，这里我们指定的根目录为 <code>/home/svn</code>。<br>
联系到authz文件中，<code>[/]</code>节中的权限则对应 <code>/home/svn</code> 下权限，<code>[project:/]</code>节中的权限即对应 <code>/home/svn/project</code> 下的权限。但是如果指定SVN服务根目录为 <code>/home/svn/project</code>，那么authz文件中<code>[/]</code>代表目录 <code>/home/svn/project</code>，而此时<code>[project:/]</code>则没有对应目录，因为<code>/home/svn/project</code>下并没有名为project的仓库，所以就会出错。<br>
如果修改了SVN的配置文件，那么需要重启SVN服务器才能使修改生效。</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># ps -aux|grep svnserve</span></span><br><span class="line"><span class="preprocessor"># kill -9 pid_of_svnserve</span></span><br><span class="line"><span class="preprocessor"># svnserve -d -r /home/svn</span></span><br></pre></td></tr></table></figure>
<h2>在防火墙中开放SVN端口</h2>
<p>如果不在防火墙中开放SVN默认端口3690，则会出现，服务器本机可以访问SVN服务，而其它网内机器无法连接SVN服务器的错误。<br>
首先关闭selinux，修改 <code>/etc/selinux/config</code> 文件</p>
<figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SELINUX</span>=<span class="string">disabled</span></span><br></pre></td></tr></table></figure>
<p>SVN服务的默认端口为3690，设置防火墙开放3690端口</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># iptables -I INPUT -p tcp --dport 3690 -j ACCEPT</span></span><br><span class="line"><span class="preprocessor"># iptables -I OUTPUT -p tcp --sport 3690 -j ACCEPT</span></span><br><span class="line"><span class="preprocessor"># service iptables save</span></span><br><span class="line"><span class="preprocessor"># service iptables restart</span></span><br></pre></td></tr></table></figure>
<h2>测试SVN服务器</h2>
<p>随意找一个目录，尝试从SVN服务器签出(check out)仓库</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># svn co svn://58.154.190.***/project</span></span><br><span class="line">Authentication realm: &lt;svn://<span class="number">58.154</span><span class="number">.190</span>.***:<span class="number">3690</span>&gt; ecf95e5d-5de1-44de-91b3-f44b1bd795d1</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'root'</span>: </span><br><span class="line">Authentication realm: &lt;svn://<span class="number">58.154</span><span class="number">.190</span>.***:<span class="number">3690</span>&gt; ecf95e5d-5de1-44de-91b3-f44b1bd795d1</span><br><span class="line">Username: admin</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'admin'</span>: </span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">ATTENTION!  Your password <span class="keyword">for</span> authentication realm:</span><br><span class="line"></span><br><span class="line">   &lt;svn://<span class="number">58.154</span><span class="number">.190</span>.***:<span class="number">3690</span>&gt; ecf95e5d-5de1-44de-91b3-f44b1bd795d1</span><br><span class="line"></span><br><span class="line">can only be stored to disk unencrypted!  You are advised to configure</span><br><span class="line">your system so that Subversion can store passwords encrypted, <span class="keyword">if</span></span><br><span class="line">possible.  See the documentation <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">You can avoid future appearances of this <span class="keyword">warning</span> by setting the value</span><br><span class="line">of the <span class="string">'store-plaintext-passwords'</span> option to either <span class="string">'yes'</span> or <span class="string">'no'</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">'/root/.subversion/servers'</span>.</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">Store password unencrypted (yes/no)?yes </span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line">A    project/IntelPerformanceCounterMonitorV2.4/pcm3d/widget.h</span><br><span class="line">A    project/IntelPerformanceCounterMonitorV2.4/pcm-memory.cpp</span><br><span class="line">A    project/IntelPerformanceCounterMonitorV2.4/pcm-sensor.cpp</span><br><span class="line">A    project/IntelPerformanceCounterMonitorV2.4/.gitattributes</span><br><span class="line">Checked out revision <span class="number">1.</span></span><br></pre></td></tr></table></figure>
<p>在第一次签出的时候会提示是否保存明文密码(因为SVN的密码是明文保存的，所以SVN的账户安全依赖与Linux系统账户的安全)选择&quot;yes&quot;的话下次就不需要在输入密码了，反之，选择&quot;no&quot;的话下次操作还需进行身份验证。如果想换个身份操作SVN或者密码输错太多被拒绝，可以删除用户目录下的 <code>～/.subversion</code> 文件夹以清空身份信息。<br>
如果能顺利 check out revision 则表明独立SVN服务器配置已成功。<br>
这时不论是在服务器本机上还是其它客户端机器，均能使用SVN服务。对于客户端操作系统为Windows的计算机，可以安装TortoiseSVN进行相应的客户端操作。</p>
<hr>
<h1>为SVN服务器添加HTTP支持</h1>
<p>经过上面的配置过程后，SVN服务器已经可以正常使用，但是，只能通过SVN协议，无法通过http协议访问。为SVN服务器添加HTTP支持可以使得用户能用浏览器通过HTTP协议直接查看仓库内容，同时也可以在代码签出提交时使用HTTP协议。</p>
<h2>安装必要包</h2>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd mod_dav_svn mod_perl  <span class="keyword">perl</span>* ntsysv <span class="keyword">vim</span>-enhanced</span><br></pre></td></tr></table></figure>
<h2>转换SVN明文密码为HTTP要求的加密格式</h2>
<p>SVN的密码是明文保存的，而http服务器不支持明文密码，所以需要将SVN服务的明文密码转换为http要求的加密格式，可以通过以下的perl脚本完成：<br>
移动到 <code>/home/svn/project/conf</code> 目录下，新建并编辑perl脚本 <code>PtoWP.pl</code>  (此脚本的作者为ha97)</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> /home/svn/project/<span class="keyword">conf</span>/</span><br><span class="line">vim PtoWP.<span class="keyword">pl</span></span><br></pre></td></tr></table></figure>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br><span class="line"><span class="keyword">use</span> warnings;</span><br><span class="line"><span class="keyword">use</span> strict;</span><br><span class="line"></span><br><span class="line"><span class="comment">#open the svn passwd file</span></span><br><span class="line"><span class="keyword">open</span> (FILE, <span class="string">"passwd"</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Cannot open the passwd file!!!n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#clear the apache passwd file</span></span><br><span class="line"><span class="keyword">open</span> (OUT_FILE, <span class="string">"&gt;webpasswd"</span>) <span class="keyword">or</span> <span class="keyword">die</span> (<span class="string">"Cannot open the webpasswd file!!!n"</span>);</span><br><span class="line"><span class="keyword">close</span> (OUT_FILE);</span><br><span class="line"></span><br><span class="line"><span class="comment">#begin</span></span><br><span class="line"><span class="keyword">foreach</span> () &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_</span> =~ <span class="regexp">m/^[^#].*=/</span>) &#123;</span><br><span class="line"><span class="variable">$_</span> =~ <span class="regexp">s/=//</span>;</span><br><span class="line"><span class="string">`htpasswd -b webpasswd $_`</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为脚本添加可执行属性</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># chmod +x PtoWP.pl</span></span><br></pre></td></tr></table></figure>
<p>在目录 <code>/home/svn/project/conf/passwd</code> 所在目录中运行<code>PtoWP.pl</code>脚本，对passwd文件进行转换</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># ./PtoWP.pl</span></span><br></pre></td></tr></table></figure>
<p>转换过程如下</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Adding</span> <span class="literal">password</span> for <span class="keyword">user</span> admin</span><br><span class="line"><span class="constant">Adding</span> <span class="literal">password</span> for <span class="keyword">user</span> role_a</span><br><span class="line"><span class="constant">Adding</span> <span class="literal">password</span> for <span class="keyword">user</span> role_b</span><br></pre></td></tr></table></figure>
<p>转换完成后目录下会出现一个 <code>webpasswd</code> 文件，即为http支持的密码文件。</p>
<h2>修改http.conf，使得http支持SVN</h2>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span> /etc/httpd/<span class="keyword">conf</span>/httpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
<p>在<code>httpd.conf</code>文件的最后添加如下信息</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务模块</span></span><br><span class="line"><span class="constant">D</span>AV svn</span><br><span class="line"><span class="comment"># SVN仓库根目录</span></span><br><span class="line"><span class="constant">S</span>VNPath /<span class="literal">home</span>/svn/<span class="literal">project</span>/</span><br><span class="line"><span class="comment"># 授权方式,这里配置为基本授权方式</span></span><br><span class="line"><span class="constant">Auth</span>Type <span class="constant">Basic</span></span><br><span class="line"><span class="comment"># 授权名</span></span><br><span class="line"><span class="constant">Auth</span>Name <span class="string">"svn for project"</span></span><br><span class="line"><span class="comment"># 用户名及用户密码文件</span></span><br><span class="line"><span class="constant">Auth</span>UserFile /<span class="literal">home</span>/svn/<span class="literal">project</span>/conf/webpasswd</span><br><span class="line"><span class="comment"># 访问权限配置文件</span></span><br><span class="line"><span class="constant">Authz</span>SVNAccessFile /<span class="literal">home</span>/svn/<span class="literal">project</span>/conf/authz</span><br><span class="line"><span class="constant">Satisfy</span> all</span><br><span class="line"><span class="comment"># 访问方式，这里配置为必须输入账户密码</span></span><br><span class="line"><span class="constant">Require</span> valid-<span class="keyword">user</span></span><br></pre></td></tr></table></figure>
<p>看了不少文章，有部分文章说在这里还需添加两个模块的语句，另外还需要 <code>yum install subversion-deps-*</code> 包来使得svn得到http的支持。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword"><span class="common">LoadModule</span></span> dav_svn_module modules/mod_dav_svn.so</span><br><span class="line"><span class="keyword"><span class="common">LoadModule</span></span> authz_svn_module modules/mod_authz_svn.so</span><br></pre></td></tr></table></figure>
<p>但是，根据官方的说明(Please note that the dependencies distribution subversion-deps-* is no longer available in 1.7 and later.)也就是说在1.7以及1.7之后的版本中不需要安装依赖的<code>subversion-deps-*</code>包，而本人实验证明，也不需要在<code>httpd.conf</code>文件中添加上述两行加载模块的语句。</p>
<p>修改SVN主目录的所有者和所属组为Apache</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chown -R apache.apache <span class="regexp">/home/</span>svn<span class="regexp">/project/</span></span><br></pre></td></tr></table></figure>
<h2>在防火墙中开放httpd服务的80端口</h2>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span></span><br><span class="line"><span class="preprocessor"># iptables -I OUTPUT -p tcp --sport 80 -j ACCEPT</span></span><br><span class="line"><span class="preprocessor"># service iptables save</span></span><br><span class="line"><span class="preprocessor"># service iptables restart</span></span><br></pre></td></tr></table></figure>
<p>如果不在防火墙中开放80端口，则会出前客户机无法通过http协议连接SVN服务器的情况。<br>
<strong>注:</strong> 关于服务重启命令，在fedora 19中采用的是systemctl restart service_name.service形式。</p>
<h2>重启httpd服务</h2>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># service httpd restart</span></span><br></pre></td></tr></table></figure>
<h2>通过浏览器测试</h2>
<p>在浏览器地址栏输入 <code>http://your_svn_server_ip/project</code>，在弹出的身份确认框中输入用户名密码，能通过浏览器查看SVN仓库。<br>
同时可以通过http协议执行svn操作</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ svn co <span class="string">http:</span><span class="comment">//your_svn_server_ip/project</span></span><br><span class="line">Authentication <span class="string">realm:</span> &lt;<span class="string">http:</span><span class="comment">//58.154.190.***:80&gt; svn for project</span></span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'chen'</span>: </span><br><span class="line">Authentication <span class="string">realm:</span> &lt;<span class="string">http:</span><span class="comment">//58.154.190.***:80&gt; svn for project</span></span><br><span class="line"><span class="string">Username:</span> admin</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'admin'</span>:</span><br></pre></td></tr></table></figure>
<h1>参考资料</h1>
<p><a href="http://www.ha97.com/4467.html" target="_blank" rel="external">（总结）CentOS Linux搭建SVN Server配置详解</a></p>

            
      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fancyseeker.github.io/2013/11/17/svn/" data-id="ci8azd2zp000k98dyepddzm6s" class="article-share-link" data-share="baidu">分享到</a>
      

      
        <a href="http://fancyseeker.github.io/2013/11/17/svn/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CentOS/">CentOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fedora/">Fedora</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SVN/">SVN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apache/">apache</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maintenance/">maintenance</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/server/">server</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/12/30/ssh_overview/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong>
      <div class="article-nav-title">
        
          SSH连接认证原理概述
        
      </div>
      </strong>
    </a>
  
  
    <a href="/2013/03/25/forwhat/" id="article-nav-older" class="article-nav-link-wrap">
      <strong>
      <div class="article-nav-title">
          为了什么而生活
      </div>
      </strong>
    </a>
  
</nav>


  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2013/11/17/svn/" data-title="CentOS/Fedora下SVN+Apache服务器配置" data-url="http://fancyseeker.github.io/2013/11/17/svn/"></div>
  </section>

</section>
      
        
          <div id="toc-wrap">
            <div id="toc" class="toc-article">
              <div id="toc-title">目录</div>
              <div id="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">SVN简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">安装环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">SVN服务器配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">安装subversion包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.</span> <span class="toc-text">初始化版本仓库(Repositories)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.</span> <span class="toc-text">用户管理及权限设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.1.</span> <span class="toc-text">添加用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.2.</span> <span class="toc-text">用户访问策略配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.3.</span> <span class="toc-text">SVN全局配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.4.</span> <span class="toc-text">启动SVN服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.5.</span> <span class="toc-text">在防火墙中开放SVN端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.6.</span> <span class="toc-text">测试SVN服务器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">为SVN服务器添加HTTP支持</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.1.</span> <span class="toc-text">安装必要包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.2.</span> <span class="toc-text">转换SVN明文密码为HTTP要求的加密格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.3.</span> <span class="toc-text">修改http.conf，使得http支持SVN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.4.</span> <span class="toc-text">在防火墙中开放httpd服务的80端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.5.</span> <span class="toc-text">重启httpd服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.6.</span> <span class="toc-text">通过浏览器测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol></div>
            </div>
          </div>
        
    
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 fancyseeker<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Based on <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"fancyseeker"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>window._bd_share_config={"common":{},"share":{"bdCustomStyle":"/css/bdshare.css"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js" type="text/javascript"></script>

</div>
</body>
</html>

